import{r as n,j as e,Y as U,b as F}from"./app-B8wJlkXe.js";import{S as f}from"./sweetalert2.all-C9JU52f1.js";import{G as B,H as V}from"./GuestRegisterForm-BKIaGqOT.js";import{a as W,m as z,p as A,Q as E,M,s as $}from"./Data-IujO-3wl.js";import{b as o,d as v}from"./index-CBUsuKQ3.js";import{c as Y}from"./index-DuHDXjoJ.js";import{G as H}from"./index-B317YNQC.js";import{l as j,s as _}from"./chunk-OKTOLZE5-DRMDYx0s.js";import{s as h}from"./chunk-IXXDDLGU-BXG-Bsk3.js";import{i as y}from"./chunk-ZH5EUE66-CxEA0QPJ.js";import"./iconBase-D4Ysufdu.js";import"./chunk-X4CB5I5S-vu_TbDwe.js";import"./chunk-XHQUSKIE-BlY06RPx.js";import"./useDialog-DL7tfeNG.js";import"./useControlledState-CodWoSaW.js";import"./VisuallyHidden-DsRFQPz7.js";import"./chunk-6NL67ZRH-ClE0TNvt.js";import"./getScrollParent-DSOL5RJh.js";import"./chunk-3XT5V4LF-DQBoBbEA.js";import"./chunk-QY5NICTW-B9fTEPo-.js";import"./chunk-HUKVTWEI-4_S4PGkY.js";import"./index-m2iL5YNw.js";import"./index-BpPyH1Gw.js";import"./useField-BOmeLJZo.js";import"./chunk-CIZQCQPA-BvWtGa_4.js";import"./useFilter-DPz-8jur.js";import"./useMenuTriggerState-CgLG_V_L.js";import"./LiveAnnouncer-CuNtP5Ew.js";import"./chunk-VGNVQLL4-bgx7yXiI.js";import"./chunk-7F3ZLNJ6-V0JqOB_6.js";import"./chunk-44JHHBS2-C6KDo9V4.js";const Ie=({guests:l,name:c})=>{const[d,u]=n.useState(""),[p,w]=n.useState(c),[r,m]=n.useState({meeting_with:"",purpose_of_visit:"",check_in_time:"",check_out_time:""}),[C,k]=n.useState(""),[S,N]=n.useState(!1),[g,b]=n.useState(""),I=t=>{const{name:i,value:a}=t.target;m({...r,[i]:a})},P=async t=>{t.preventDefault();const i=new Date(r.check_in_time).toISOString().slice(0,19).replace("T"," "),a={...r,check_in_time:i.toString(),check_out_time:r.check_out_time?new Date(r.check_out_time).toISOString():null,purpose_of_visit:r.purpose_of_visit==="Other"?g:r.purpose_of_visit};try{const s=await F.post(`/guest/log/new/${d}`,a),x=s.data.guestLogId,L=s.data.qrCodeUrl;f.fire({title:"Success",icon:"success",showConfirmButton:!1,timer:1e3}),k(L),N(!0)}catch{f.fire("Error","There was an error submitting the form","error")}},R=()=>{const t=new Date,i=t.getTimezoneOffset()*6e4,s=new Date(t.getTime()-i).toISOString().slice(0,16);m(x=>({...x,check_in_time:s}))};n.useEffect(()=>{const t=l.find(i=>i.name===c);t&&u(t.id)},[c,l]);const T=t=>{w(t.target.value)},D=l.filter(t=>t.name.toLowerCase().includes(p.toLowerCase())).sort((t,i)=>t.name.localeCompare(i.name)),O=t=>{const{value:i}=t.target;m({...r,purpose_of_visit:i}),i!=="Other"&&b("")},G=()=>{f.fire({title:"Are you sure?",text:"You are about to close this page. Please ensure that the QR code has been captured or printed.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, close it",cancelButtonText:"Cancel",cancelButtonColor:"#3085d6",confirmButtonColor:"#d33"}).then(t=>{t.isConfirmed&&v.Inertia.visit("/")})},Q=t=>{const a=document.querySelector("canvas").toDataURL("image/png").replace("image/png","image/octet-stream"),s=document.createElement("a");s.href=a;const x=new Date().toISOString().slice(0,10);s.download=`qr_code_generated_on_${x}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},q=()=>{const i=document.querySelector("canvas").toDataURL("image/png"),a=$.renderToString(e.jsx(K,{guestName:d,meetingWith:r.meeting_with,purposeOfVisit:r.purpose_of_visit==="Other"?g:r.purpose_of_visit,checkInTime:r.check_in_time,checkOutTime:r.check_out_time,qrCodeUrl:i})),s=window.open("","_blank","hidden=yes");s.document.open(),s.document.write("<html><head><title>Print</title>"),s.document.write("</head><body>"),s.document.write(a),s.document.write("</body></html>"),s.document.close(),s.onload=function(){s.focus(),s.print(),s.close()}};return e.jsxs("div",{className:"min-h-screen bg-[url(/assets/images/bg.png)] bg-cover",children:[e.jsx(U,{title:"Log Guest"}),e.jsx("div",{className:"py-12 p-4 flex justify-center items-center",children:e.jsxs("div",{className:"max-w-2xl w-full mx-auto p-4 bg-white shadow-md rounded-lg py-5",children:[e.jsxs("div",{className:"text-center  mb-5",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 ",children:e.jsxs("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary relative",children:["Guest Log Form",e.jsx("span",{className:"absolute  left-1/2 transform -translate-x-1/2 -bottom-2 h-[3px] w-16 bg-[#2aefe6]"})]})}),e.jsx("p",{className:"text-sm font-light",children:"Please fill out the form below to log your visit today."})]}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx(W,{label:e.jsx(e.Fragment,{children:e.jsx("b",{children:"Guest Name"})}),labelPlacement:"outside",placeholder:"Search your name here",description:"If you don't see your name here, please click 'New Guest' button to register.",selectedKey:d,onSelectionChange:u,isRequired:!0,onInput:T,children:p&&D.map(t=>e.jsx(j,{value:t.id,children:t.name},t.id))}),e.jsx(B,{})]}),e.jsx(h,{y:2}),e.jsx("div",{className:"mb-4",children:e.jsx(_,{label:e.jsx(e.Fragment,{children:e.jsx("b",{children:"Meeting With"})}),labelPlacement:"outside",placeholder:"Select",value:r.meeting_with,onChange:t=>m({...r,meeting_with:t.target.value}),children:z.map(t=>e.jsx(j,{value:t.value,children:`${t.label} - ${t.position}`},t.value))})}),e.jsx(h,{y:2}),e.jsxs("div",{className:"mb-4",children:[e.jsx(_,{label:e.jsx(e.Fragment,{children:e.jsx("b",{children:"Purpose of Visit"})}),labelPlacement:"outside",placeholder:"Select",value:r.purpose_of_visit,onChange:O,isRequired:!0,children:A.map(t=>e.jsx(j,{value:t.value,children:t.label},t.value))}),e.jsx(h,{y:2}),r.purpose_of_visit==="Other"&&e.jsx(y,{placeholder:"Please input your purpose of visit",value:g,onChange:t=>b(t.target.value),isRequired:!0})]}),e.jsx(h,{y:2}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx(y,{label:e.jsx(e.Fragment,{children:e.jsx("b",{children:"Check In Time"})}),placeholder:"Check In",description:"Please enter your check in time or click the button to check in.",labelPlacement:"outside",type:"datetime-local",name:"check_in_time",value:r.check_in_time,onChange:I,isRequired:!0,onClear:()=>m({...r,check_in_time:""})}),e.jsx("div",{className:"hidden md:flex items-center text-sm text-gray-400 uppercase before:flex-[1_1_0%] before:border-t before:border-gray-200 before:me-6 after:flex-[1_1_0%] after:border-t after:border-gray-200 after:ms-6",children:"Or"}),e.jsx(o,{color:"primary",variant:"shadow",onClick:R,className:"mt-6 ",children:"Check In"})]}),e.jsx(h,{y:7}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{size:"lg",color:"primary",variant:"shadow",type:"submit",startContent:e.jsx(V,{className:"w-6 h-6 text-success"}),children:"Submit"}),e.jsx(o,{size:"lg",color:"danger",onClick:()=>v.Inertia.visit("/"),startContent:e.jsx(H,{className:"w-4 h-4"}),children:"Cancel"})]})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-[url(/assets/images/bg.png)] bg-cover bg-opacity-100 z-50 p-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md space-y-4 w-full mx-4",children:[e.jsxs("div",{className:"flex justify-center",children:[e.jsxs("h1",{className:"hidden md:block text-center",children:[e.jsx("span",{className:"text-danger",children:"*"})," Please capture this QR code using your mobile phone or print it out. This will be used for checking out."]}),e.jsxs("h1",{className:"md:hidden text-center",children:[e.jsx("span",{className:"text-danger",children:"*"})," Please download this QR code or take a screenshot using your mobile phone. This will be used for checking out."]})]}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(E,{value:C,size:350})," "]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{color:"primary",variant:"shadow",onClick:q,className:"hidden sm:block",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4 text-success"}),"Print QR"]})}),e.jsx(o,{color:"primary",variant:"shadow",onClick:()=>Q(),className:"sm:hidden",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-6 h-6 text-success-400"}),"Download QR"]})}),e.jsx(o,{color:"danger",onClick:G,children:"Close"})]})]})})]})},K=({guestName:l,meetingWith:c,purposeOfVisit:d,checkInTime:u,qrCodeUrl:p})=>e.jsxs("div",{style:{padding:"10px",fontFamily:"Arial, sans-serif",width:"80mm",maxWidth:"80mm",wordWrap:"break-word"},children:[e.jsx("h2",{style:{textAlign:"center",marginRight:"40px"},children:"Guest Pass"}),e.jsx("p",{style:{textAlign:"center",marginRight:"40px"},children:"Scan this QR code to check out. Please keep it with you."}),e.jsx("hr",{style:{marginRight:"40px"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{marginBottom:"10px",textAlign:"left",width:"100%"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Guest ID:"})," ",l]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Meeting With:"})," ",c]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Purpose of Visit:"})," ",d]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Check In:"})," ",new Date(u).toLocaleString([],{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})]})]}),e.jsx("div",{style:{marginTop:"10px",marginRight:"40px"},children:e.jsx("img",{src:p,alt:"QR Code",style:{width:"250px",height:"250px"}})})]}),e.jsx("hr",{style:{marginRight:"40px"}}),e.jsx("div",{style:{textAlign:"center",marginTop:"10px",marginRight:"40px"},children:e.jsx("p",{children:"Thank you for visit!"})})]});export{K as PrintableGuestPass,Ie as default};
